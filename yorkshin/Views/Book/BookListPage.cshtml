@{
    ViewBag.Title = "書籍清單";
    Layout = "_AsiLayout";
    List<string> departmentArr = ViewBag.DepartmentArray;
    List<string> courseArr = ViewBag.CourseArray;
    List<string> statusArray = ViewBag.StatusArray;
}
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="exclamation-triangle-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
    </symbol>
</svg>

<div class="container-fluid mt-3">
    <div class="search-field row justify-content-end align-items-center">
        <button type="button" id="AddBookBtn" class="btn col-1 mx-2" data-bs-toggle="modal" data-bs-target="#addBookModal">新增書籍</button>
    </div>
    <div class="list-field mt-2">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            @*BookList Area*@
            <li class="nav-item" role="presentation">
                <button aria-inval class="nav-link active" id="bookList-tab" data-bs-toggle="tab" data-bs-target="#bookList" type="button" role="tab" aria-controls="bookList" aria-selected="false">書籍清單</button>
            </li>
            @*WaitingAcceptList Area*@
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="waitingAcceptList-tab" data-bs-toggle="tab" data-bs-target="#waitingAcceptList" type="button" role="tab" aria-controls="waitingAcceptList" aria-selected="true">待接受清單</button>
            </li>
            @*AcceptedList Area*@
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="acceptedList-tab" data-bs-toggle="tab" data-bs-target="#acceptedList" type="button" role="tab" aria-controls="acceptedList" aria-selected="false">已接受清單</button>
            </li>
            @*SoldList Area*@
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="soldList-tab" data-bs-toggle="tab" data-bs-target="#soldList" type="button" role="tab" aria-controls="soldList" aria-selected="false">已賣出清單</button>
            </li>
            @*Comment Area*@
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="comment-tab" data-bs-toggle="tab" data-bs-target="#comment" type="button" role="tab" aria-controls="comment" aria-selected="false">評論</button>
            </li>

            @* <li class="nav-item dropdown ms-auto"> *@
            @*     <button class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">排序</button> *@
            @*     $1$ sorting #1# *@
            @*     <ul class="dropdown-menu"> *@
            @*         <li> *@
            @*             <button class="dropdown-item" href="#"></button> *@
            @*         </li> *@
            @*     </ul> *@
            @* </li> *@
        </ul>
        <div class="tab-content min-vh-100" id="content" >
            @*BookList Area*@
            <div class="tab-pane fade active show" id="bookList" role="tabpanel" aria-labelledby="bookList-tab">
                @await Component.InvokeAsync("BookListPartial")
                <vc:BookListPartialViewComponent></vc:BookListPartialViewComponent>
            </div>
            @* WaitingAcceptList  area *@
            <div class="tab-pane fade" id="waitingAcceptList" role="tabpanel" aria-labelledby="waitingAcceptList-tab">
                @await Component.InvokeAsync("WaitingAcceptListPartial")
                <vc:WaitingAcceptListPartialViewComponent></vc:WaitingAcceptListPartialViewComponent>
            </div>
            @* AcceptedList area *@
            <div class="tab-pane fade" id="acceptedList" role="tabpanel" aria-labelledby="acceptedList-tab">
                @await Component.InvokeAsync("AcceptedListPartial")
                <vc:AcceptedListPartialViewComponent></vc:AcceptedListPartialViewComponent>
            </div>
            @* SoldList Area*@
            <div class="tab-pane fade" id="soldList" role="tabpanel" aria-labelledby="soldList-tab">
                @await Component.InvokeAsync("SoldListPartial")
                <vc:SoldListPartialViewComponent></vc:SoldListPartialViewComponent>
            </div>
            @* FinishedList Area*@
            <div class="tab-pane fade" id="finishedList" role="tabpanel" aria-labelledby="finishedList-tab">
                @await Component.InvokeAsync("FinishedListPartial")
                <vc:FinishedListPartialViewComponent></vc:FinishedListPartialViewComponent>
            </div>
            @* OrderedList Area *@
            <div class="tab-pane fade" id="orderedList" role="tabpanel" aria-labelledby="orderedList-tab">
                @await Component.InvokeAsync("OrderedListPartial")
                @*@await Component.InvokeAsync("OrderedListPartial", new { userID })*@
                <vc:OrderedListPartialViewComponent></vc:OrderedListPartialViewComponent>
            </div>
            @* Comment Area*@
            <div class="tab-pane fade" id="comment" role="tabpanel" aria-labelledby="comment-tab">
                @await Component.InvokeAsync("CommentPartial")
                <vc:CommentPartialViewComponent></vc:CommentPartialViewComponent>
            </div>
        </div>
    </div>
</div>

@* modal for adding new book *@
<div class="modal fade" id="addBookModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <div class="col">
                    <h5 class="modal-title" id="exampleModalLabel">書籍資訊</h5>
                    <span>填寫您的書籍資訊</span>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="form" asp-controller="Book" asp-action="AddBook" method="post" enctype="multipart/form-data" onsubmit="return ImgInputCheck()">
                    <input type="text" name="DepartmentList" id="departmentValueAddBook" hidden/>
                    <input type="text" name="CourseList" id="courseValueAddBook" hidden/>
                    <div class="row gx-3">
                        <div class="mb-3 col-4">
                            <label class="form-label">書名</label>
                            <input type="text" class="form-control" name="BName" required/>
                        </div>
                        <div class="mb-3 col">
                            <label class="form-label">作者</label>
                            <input type="text" class="form-control" name="Author" id="author" required/>
                        </div>
                    </div>
                    <div class="row gx-3">
                        <div class="mb-3 col-4">
                            <label class="form-label">價格</label>
                            <input type="number" class="form-control" name="Price" required/>
                        </div>
                        <div class="mb-3 col">
                            <label class="form-label">ISBN</label>
                            <input type="text" class="form-control" name="Isbn" required/>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">類別</label>
                        <div class="row">
                            <div class="col category-area">
                                <label class="form-label me-2">系所</label>
                                <button class="btn dropdown-toggle" id="departmentDropdownAddBook" type="button" data-bs-toggle="dropdown" aria-expanded="false">請選擇</button>
                                <ul class="dropdown-menu ps-2" aria-labelledby="multiSelectDropdown" id="departmentAddBook">
                                    @foreach (var item in departmentArr)
                                    {
                                        <li>
                                            <label><input type="checkbox" value="@item"/>@item</label>
                                        </li>
                                    }
                                </ul>
                            </div>
                            <div class="col">
                                <label class="form-label me-2">課程</label>
                                <button class="btn dropdown-toggle" id="courseDropdownAddBook" type="button" data-bs-toggle="dropdown" aria-expanded="false">請選擇</button>
                                <ul class="dropdown-menu ps-2" aria-labelledby="multiSelectDropdown" id="courseAddBook">
                                    @foreach (var item in courseArr)
                                    {
                                        <li>
                                            <label><input type="checkbox" value="@item"/>@item</label>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">書籍狀態</label>
                        <select class="form-select" name="BookStatus" id="description-select" required>
                            <option selected hidden></option>
                            @foreach (var status in statusArray)
                            {
                                <option value="@status">@status</option>
                            }
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">備註</label>
                        <input class="form-control" type="text" name="Description" required/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">書籍圖片</label>
                        <div class="col ms-3">
                            <div class="row mb-3">
                                <div class="input-group file-btn">
                                    <label for="input-file" class="clicked-label">
                                        <i class="material-symbols-outlined">add_photo_alternate</i>
                                    </label>
                                    <label class="input-group-text clicked-label" for="input-file">新增圖片</label>
                                    <input type="file" name="Img" class="form-control border-0" id="input-file" accept="image/*" />
                                </div>
                            </div>
                             <div id= "CheckImgInput" class="m-lg-2 align-items-center" style="color: #d13737" hidden>
                                 <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:"><use xlink:href="#exclamation-triangle-fill"/></svg>
                                 <small>請上傳圖片</small>
                             </div>
                            <img id="image-result" alt="" src="#" class="row img-fluid mb-3">
                            <button onclick="addBook()" type="submit" class="row btn UpdateBtn">完成並上架</button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="CancelBtn" class="btn" data-bs-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>

@* import script *@
<script src="~/Scripts/BookListPage.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
@* <style> *@
@*     /* [Master Stylesheet - v1.0] */ *@
@*     /* :: 1.0 Import Fonts */ *@
@*     @@import url("https://fonts.googleapis.com/css?family=Archivo+Narrow:400,400i,500,500i,600,600i,700,700i"); *@
@*     /* :: 2.0 Import All CSS */ *@
@*     @@import url(css/classy-nav.css); *@
@*     @@import url(./css/Info.css); *@
@* </style> *@
<script>
function ImgInputCheck() {
    // 取得評論內容
    var ImgInput = document.getElementById('input-file').value;
    console.log("ImgInput",ImgInput)
    // 檢查評論長度是否超過 100
    if (ImgInput === '') {
        // 顯示 評論長度限制的警告
        document.getElementById('CheckImgInput').removeAttribute('hidden');
        return false; // 阻止表單提交
    }

    // 隐藏评论长度限制警告
    document.getElementById('CheckImgInput').setAttribute('hidden', 'true');
    return true; // 允许表單提交
}
</script>